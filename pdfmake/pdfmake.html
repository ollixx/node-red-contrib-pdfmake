<script type="text/javascript">
    RED.nodes.registerType('pdfmake', {
        category: "advanced",
        color: "rgb(222, 189, 92)",
        icon: "font-awesome/fa-file-pdf-o",
        defaults: {
            name: { value: "" },
            outputType: {value: "base64"},
            inputProperty: {value: "payload", required: true},
            inputPropertyType: {value: "msg"},
            tableOptions: {value: "{}"},
            tableOptionsType: {value: "json"},
            fonts: {value: "{}"},
            fontsType: {value: "json"},
            vfs: {value: "{}"},
            vfsType: {value: "json"},
            outputProperty: {value: "payload"},
            outputPropertyType: {value: "msg"},
        },
        label: function () {
            return this.name || "pdfmake";
        },
        inputs: 1,
        outputs: 1,
        paletteLabel: "pdfmake",
        oneditprepare: function () {
            $("#node-input-outputType").typedInput({type:"outputType", types:[{
                value: "outputType",
                options: [
                    { value: "base64", label: "Base64"},
                    { value: "buffer", label: "Buffer"}
                ]
            }]})

            $("#node-input-inputProperty").typedInput({
                default: "msg",
                types: ["msg","global", "flow", "json", "jsonata"],
                typeField: $("#node-input-inputPropertyType")
            });
            $("#node-input-tableOptions").typedInput({
                default: "json",
                types: ["msg","global", "flow", "json", "jsonata"],
                typeField: $("#node-input-tableOptionsType")
            });
            $("#node-input-fonts").typedInput({
                default: "json",
                types: ["msg","global", "flow", "json", "jsonata"],
                typeField: $("#node-input-fontsType")
            });
            $("#node-input-vfs").typedInput({
                default: "json",
                types: ["msg","global", "flow", "json", "jsonata"],
                typeField: $("#node-input-vfsType")
            });
            $("#node-input-outputProperty").typedInput({
                default: "msg",
                types: ["msg","global", "flow"],
                typeField: $("#node-input-outputPropertyType")
            });

        },
        oneditsave: function () {
            // save parameter sources for selected component
            // $("#node-input-info").val(this.editor.getValue());
            // get target node ID
            //debugger
            // this.outputType = $("#node-input-outputType").children("option:selected").val();

            /*for (let fieldName of ['inputProperty', 'tableOptions', 'fonts', 'vfs', 'outputProperty'] ) {
                let field = $(`#node-input-${fieldName}`);
                this[fieldName] = {
                    "value": field.typedInput("value"),
                    "type": field.typedInput("type")
                }
            }*/
        }
	});
</script>
<script type="text/x-red" data-template-name="pdfmake">
    <div class="form-row">
        <label for="node-input-name" ><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-inputProperty"><i class="fa fa-ellipsis-h"></i> <span data-i18n="pdfmake.label.inputProperty"></span></label>
        <input id="node-input-inputProperty">
        <input type="hidden" id="node-input-inputPropertyType">
    </div>
    <div class="form-row">
        <label for="node-input-tableOptions"><i class="fa fa-code"></i> <span data-i18n="pdfmake.label.tableOptions"></span></label>
        <input id="node-input-tableOptions">
        <input type="hidden" id="node-input-tableOptionsType">
    </div>
    <div class="form-row">
        <label for="node-input-fonts"><i class="fa fa-code"></i> <span data-i18n="pdfmake.label.fonts"></span></label>
        <input id="node-input-fonts">
        <input type="hidden" id="node-input-fontsType">
    </div>
    <div class="form-row">
        <label for="node-input-vfs"><i class="fa fa-code"></i> <span data-i18n="pdfmake.label.vfs"></span></label>
        <input id="node-input-vfs">
        <input type="hidden" id="node-input-vfsType">
    </div>
    <div class="form-row">
        <label for="node-input-outputType"><i class="fa fa-sign-out"></i> <span data-i18n="pdfmake.label.outputType"></span></label>
        <input type="text" id="node-input-outputType" placeholder="output type">
    </div>
    <div class="form-row">
        <label for="node-input-outputProperty"><i class="fa fa-sign-out"></i> <span data-i18n="pdfmake.label.outputProperty"></span></label>
        <input id="node-input-outputProperty">
        <input type="hidden" id="node-input-outputPropertyType">
    </div>
</script>
 